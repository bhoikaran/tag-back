<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Info</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .card {
      max-width: 560px;
      background: white;
      margin: 20px auto;
      padding: 24px;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }
    h2 { color: #2c3e50; margin: 0 0 6px 0 }
    .info-row { display: flex; gap: 12px; padding: 10px 0; align-items: flex-start; border-bottom: 1px solid #f1f3f5 }
    .info-row:last-child { border-bottom: none }
    .info-title { width: 110px; color: #4a90e2; font-weight: 600 }
    .info-value { color: #34495e; white-space: pre-wrap }
    .subtitle { color: #7f8c8d; margin: 6px 0 18px; }
    .cta-btn { display: inline-flex; align-items: center; gap: 10px; padding: 12px 20px; background: linear-gradient(90deg,#4a90e2,#357abd); color: #fff; border-radius: 10px; text-decoration: none; font-weight:700; box-shadow: 0 6px 18px rgba(53,122,189,0.18); transition: transform .15s ease, box-shadow .15s ease }
    .cta-btn i { font-size: 16px }
    .cta-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 28px rgba(53,122,189,0.22) }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
  <i class="fas fa-box"></i>
  <h2>Product Information</h2>
  <p class="subtitle">If you found this item, please contact the owner using the details below.</p>
    </div>
    <div class="card">
      <div class="info-row"><div class="info-title">Item</div><div id="item" class="info-value"></div></div>
      <div class="info-row"><div class="info-title">Owner</div><div id="owner" class="info-value"></div></div>
      <div class="info-row"><div class="info-title">Contact</div><div id="contact" class="info-value"></div></div>
      <div class="info-row"><div class="info-title">Message</div><div id="message" class="info-value"></div></div>

      <div style="text-align:center; margin-top:18px">
        <a href="index.html" class="cta-btn"><i class="fas fa-plus-circle"></i> Create your own QR for your products</a>
      </div>
    </div>
  </div>

  <!-- LZ-String so compressed QR payloads can be decoded here -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // Try to decode compressed (LZString) data first, then fall back to base64 for older QR codes
    const params = new URLSearchParams(window.location.search);
    const data = params.get('data');

    if (data) {
      let decodedObj = null;
      try {
        if (typeof LZString !== 'undefined' && LZString.decompressFromEncodedURIComponent) {
          const decompressed = LZString.decompressFromEncodedURIComponent(data);
          if (decompressed) {
            decodedObj = JSON.parse(decompressed);
          }
        }
      } catch (e) {
        console.warn('LZString decompression failed, will try base64 fallback', e);
      }

      // Fallback to base64 (legacy QR codes)
      if (!decodedObj) {
        try {
          decodedObj = JSON.parse(atob(data));
        } catch (e) {
          console.error('Failed to decode QR data:', e);
          document.body.innerHTML = "<h2>Invalid QR Data</h2>";
        }
      }

      if (decodedObj) {
        document.getElementById('item').textContent = `Item: ${decodedObj.item}`;
        document.getElementById('owner').textContent = `Owner: ${decodedObj.owner}`;
        document.getElementById('contact').textContent = `Contact: ${decodedObj.contact}`;
        document.getElementById('message').textContent = decodedObj.message || '';
      }
    } else {
      document.body.innerHTML = "<h2>No data found!</h2>";
    }
  </script>
</body>
</html>
